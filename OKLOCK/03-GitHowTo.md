# Gitの基本的な使い方

## バージョン管理システムGitとGitHubについて

バージョン管理システムとGitについての簡単な説明は以下のページを参照してください。
- [SlideShare:Git 入門ちょい手前](https://www.slideshare.net/YuichiGoto1/git-62060744)
- [Linux/Unix環境でのGit入門](http://www.aise.ics.saitama-u.ac.jp/~gotoh/IntroGitOnLinux.html)

GitHubはいくつかのサービスを提供しているWebサービスです。
- Gitのリモートリポジトリ
- Gitのフロントエンド（リポジトリへのGUI操作の提供）
- チケット管理システム
- Wiki

本講義では主にソースコード共有のための「Gitのリモートリポジトリ」と「チケット管理システム」を中心に使うことになると思います。

Macbook上で（Xcode上で）作成したソースコードやドキュメントをGitHubのリモートリポジトリに保存（push）したり、取得（pull）したりします。以下のリンク先の図中のWorkDir1がMacbook上（Xcode上）のフォルダ（ディレクトリ）になります。WorkDir2がGitHub上のリモートリポジトリになります。

- [Gitコマンドまとめ](http://www.aise.ics.saitama-u.ac.jp/~gotoh/IntroGitOnLinux.html#toc30)


## 管理対象とするファイルについて

Git（GitHub）はチーム（複数人間）でソースコードやドキュメントを管理・共有するためのソフトウェアです。このため、Gitで管理すべきファイルやディレクトリは、チームの全員で共有すべきファイル・ディレクトリのみにするべきです。個々人の環境で異なるファイル（個々人の実行環境やプログラムを実行したときの時間に依存して自動生成されるファイル）はGitの管理対象としてはいけません。

以下の特徴を持つファイルをGitの共有対象としてください。
- チーム全体で共有すべきファイル
 - ソースコード
 - 設定ファイル（データベースへのアクセス設定など）
 - アプリケーションで利用する画像データなど
 - テスト・デバッグ関連ファイル（テストコード、テスト・デバッグ用入力データ。なお、テストの出力データは含めない方が良い）
- 実行環境を設定するための文書（外部ライブラリーの名前、バージョン、配布場所、インストール方法など）


以下のファイルはGitでの管理対象としないようにします。
- 個々の環境で内容が異なるファイル（設定ファイルなど）
- アプリケーションやIDE（Xcodeなどの統合開発環境）が自動生成するファイル
 - ログファイル（典型的には拡張子が.log）
 - ロックファイル
 - その他自動生成されるファイル（一時保存ファイルなど）
- 外部ライブラリー（管理すべきファイル・ディレクトリサイズが大幅に増えるため）
- 秘密情報（パスワード、パスフレーズ、アプリケーションキーなどチーム外の人に見られてはいけないもの）

Gitの管理対象外とするファイルやディレクトリについては .gitignore というファイルをトップディレクトリに置くことでデフォルトで管理対象外にすることができます。
- [.gitignore の書き方。ファイル/ディレクトリの除外と反映方法](http://www-creators.com/archives/1662)

.gitignoreの設置方法は後ほど説明します。

## ブランチを用いたソースコード管理

Gitにはブランチ（branch）という機能があるため、ブランチを用いてソースコードの管理を行うのが一般的です。さまざまな作法がありますが、最低限、チーム全員で共有する2つのブランチ（master, dev）と個人用の1つのブランチ（ユーザ名などをブランチ名とする）を用意します。各ブランチの役割を以下のとおりです。
- master: リリース用ブランチ。テストが終了し、実機で稼働できることが保証されているソースコードのみを本ブランチに格納します。
- dev: 開発用ブランチ。masterブランチから作成します。単体テストが終了したソースコードのみを本ブランチに格納する。本ブランチで統合テストを行い、実機で稼働できることを確認できたならば、masterブランチにマージします。。
- 個人用ブランチ：試行錯誤ブランチ。このブランチで自分が担当する部分のコーディングおよび編集を行います。このブランチはdevブランチから作成します。担当した部分についての単体テストが終了したならば、devブランチにマージします。本ブランチは基本的にはチーム間で共有しません。

## Xcodeでのブランチ操作

Xcode上でブランチの作成やブランチ間のマージを行うことができます。
- [Xcodeでgit操作(ブランチを作ってみる)](https://qiita.com/sakamotoyuya/items/ffbd229010eec67e49ea)

### 日々の開発作業の流れ

- Xcodeでローカルリポジトリ（「2019-team-*」）を開く
- Xcodeのメニューから「Source Control」→「Pull」を実行する（これでGitHubのリモートリポジトリの内容がMacbook上に反映される）
- devブランチの変更内容を個人用リポジトリにマージする
- 個人用リポジトリで開発を行う
  - ひと段落ついたら「Commit」で変更箇所をローカルリポジトリに反映する。
  - 作業を終了するときには「Push」でローカルリポジトリに保存されている個人用ブランチの変更内容をGitHub上のリモートリポジトリに反映させる。
- 個人用ブランチで開発していた担当箇所について単体テストが終了した場合はdevブランチに個人用ブランチの内容を反映させる
  - 「Push」にてGitHubのリモートリポジトリの内容をローカルリポジトリに反映させる
  - devリポジトリの内容を個人用ブランチに反映させる（マージする）
  - 担当箇所にてバグが生じていないことを確かめる（devブランチからのマージにより不具合が発生したら修正し、Commitする）
  - devブランチにチェックアウトする
  - 個人用ブランチの内容をdevブランチへ反映させる（マージする）
  - 「Push」でローカルリポジトリに保存されているdevブランチと個人用ブランチの変更内容をGitHub上のリモートリポジトリに反映させる。

Masterブランチへのdevブランチの内容の反映は、チームで担当者を１名決めて、その担当者だけが行うようにしたほうが良いです。

### 個人用ブランチの作成

個人用ブランチは以下のように作成します。
- （devブランチが存在しない場合）GitHub上でmasterブランチからdevブランチを作成する。
  + Githubのリポジトリのページにて（2019-team-*のトップページ）「Branch: master」というブルダウンリストをクリックする
  + 入力欄に「dev」を入力し、Return /Enterキーを押す
  + 「Branch: dev」と表示されていればdevブランチの作成に成功している
- Xcodeでローカルリポジトリ（「2019-team-*」）を開く
- Xcodeのメニューから「Source Control」→「Pull」を実行する（これでGitHubのリモートリポジトリの内容がMacbook上に反映される）
- 「Source Code Navigator」（一番左のウィンドウのアイコン２つ目）を開く
- 「Remotes」→「origin」→「dev」のアイコンで右クリック（Macbook上だと二本指でタップ）し、「Checkout ...」を選択し、devブランチをチェックアウトする。
- 「Branches」アイコンの下に「dev (current)」というアイコンがあるはずなので、そのアイコンを右クリックし「Branch from "dev"」を選択する
- 任意の名前で個人用ブランチを作成する。

### 個人用ブランチのリモートリポジトリへの保存

現在のブランチが個人用ブランチになっていることを確認する。その上でXcodeのメニューから「Source Control」→「Push」を選択します。これで、個人用ブランチの内容がGitHub上のリモートリポジトリに保存されます。

なお、担当している箇所のバグがなくなるまで（単体テストが終わるまで）は個人用ブランチの変更内容をdevブランチにマージしてはいけません。

### devブランチの個人用ブランチへの反映（マージ）

現在のブランチが個人用ブランチになっていることを確認してください。
- 「Source Code Navigator」（一番左のウィンドウのアイコン２つ目）を開く
- devブランチのアイコン上で右クリックをし、「Merge "dev" into "個人用ブランチ名"」を選択する

## .gitignoreの設置

言語や環境ごとに推奨の.gitignoreの内容が公開されています。
- [github/gitignore](https://github.com/github/gitignore)
- [Xcode](https://github.com/github/gitignore/blob/f85cff8fbeb8bf07dd1217722a617d947160f556/Global/Xcode.gitignore)
- [XcodeでiOSアプリ開発をする時の.gitignore](https://qiita.com/ikuwow/items/4fae81a099bf82f44749)

チームの代表が devブランチに.gitignoreを追加してください。GitHub上で作業するのが簡単です。
- Githubのリポジトリのページにて（2019-team-*のトップページ）「Branch: master」というブルダウンリストをクリックし、devブランチを選択する
- アプリケーションのフォルダ（デフォルトは「enPiT2SUProduct」）に移動する
- 「Create new file」ボタンをクリックし、ファイル名「.gitignore」を作成する（スペル注意）
- .gitignoreの中身を記入する（上記のリンク先の内容をコピー＆ペーストする）
- 保存（コミット）する
